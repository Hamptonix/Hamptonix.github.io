<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="https://i.postimg.cc/HnDd4JkX/channels4-profile-removebg-preview.png" />
  <title>Hamptonix | Chat</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
    }

    .app {
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 300px;
      padding: 20px;
      background-color: #1e1e1e;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 10px 20px;
      background-color: #2a2a2a;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .composer {
      display: flex;
      padding: 20px;
      background-color: #1e1e1e;
    }

    textarea {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      resize: none;
      background-color: #2a2a2a;
      color: white;
      border: none;
    }

    .send-btn {
      background-color: #007bff;
      color: white;
      padding: 10px 15px;
      margin-left: 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    input {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 4px;
      border: none;
      background-color: #2a2a2a;
      color: white;
    }

    button {
      margin-top: 10px;
      padding: 10px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    #auth-error {
      color: #ff4d4d;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="app">
  <!-- Sidebar: Auth form -->
  <div class="sidebar" id="auth-section">
    <h3>Login / Sign Up</h3>
    <div id="login-form">
      <label>Email</label>
      <input type="email" id="emailInput" placeholder="Enter your email" />
      <label>Password</label>
      <input type="password" id="passwordInput" placeholder="Enter your password" />
      <button id="loginBtn">Login</button>
      <button id="signUpBtn">Sign Up</button>
      <div id="auth-error"></div>
    </div>
  </div>

  <!-- Main chat area -->
  <div class="main" id="chat-section" style="display: none;">
    <div class="header">
      <h3>Welcome to Hamptonix</h3>
      <button id="signOutBtn">Sign Out</button>
    </div>
    <div class="messages" id="messagesDiv"></div>
    <div class="composer">
      <textarea id="msgInput" placeholder="Type your message..." disabled></textarea>
      <button class="send-btn" id="sendBtn" disabled>Send</button>
    </div>
  </div>
</div>

<!-- Firebase SDK (Modular) -->
<script type="module">
  // Firebase Modular Imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  // 🔐 Replace with your actual Firebase project config
  const firebaseConfig = {
    apiKey: "AIzaSyB5J4QTNIxYQrGCmnDWtGkiQ8ehi5PfGWI",
    authDomain: "livechat-4b94e.firebaseapp.com",
    databaseURL: "https://livechat-4b94e-default-rtdb.firebaseio.com",
    projectId: "livechat-4b94e",
    storageBucket: "livechat-4b94e.firebasestorage.app",
    messagingSenderId: "951972267887",
    appId: "1:951972267887:web:b7e96c86e8c5ca94098a9a",
    measurementId: "G-5WF1LLM7FH"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // UI references
  const emailInput = document.getElementById('emailInput');
  const passwordInput = document.getElementById('passwordInput');
  const loginBtn = document.getElementById('loginBtn');
  const signUpBtn = document.getElementById('signUpBtn');
  const signOutBtn = document.getElementById('signOutBtn');
  const authError = document.getElementById('auth-error');
  const chatSection = document.getElementById('chat-section');
  const authSection = document.getElementById('auth-section');
  const sendBtn = document.getElementById('sendBtn');
  const msgInput = document.getElementById('msgInput');

  // Auth event handlers
  signUpBtn.addEventListener('click', async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      handleUserLogin(userCredential.user);
    } catch (error) {
      authError.innerText = "Sign up failed: " + error.message;
    }
  });

  loginBtn.addEventListener('click', async () => {
    const email = emailInput.value;
    const password = passwordInput.value;
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      handleUserLogin(userCredential.user);
    } catch (error) {
      authError.innerText = "Login failed: " + error.message;
    }
  });

  signOutBtn.addEventListener('click', () => {
    signOut(auth).then(() => {
      localStorage.clear();
      location.reload();
    }).catch((error) => {
      console.error("Sign-out error:", error);
    });
  });

  // On auth state change
  onAuthStateChanged(auth, user => {
    if (user) {
      updateUI(user);
    } else {
      authSection.style.display = 'block';
      chatSection.style.display = 'none';
    }
  });

  function handleUserLogin(user) {
    localStorage.setItem('userId', user.uid);
    localStorage.setItem('username', user.email.split('@')[0]);
    updateUI(user);
  }

  function updateUI(user) {
    authSection.style.display = 'none';
    chatSection.style.display = 'flex';
    msgInput.disabled = false;
    sendBtn.disabled = false;
  }

  // Message sending logic
  sendBtn.addEventListener('click', async () => {
    const text = msgInput.value.trim();
    if (!text) return;

    const userId = localStorage.getItem('userId');
    const username = localStorage.getItem('username') || "Guest";

    try {
      await addDoc(collection(db, "messages"), {
        userId,
        username,
        usernameColor: "#ffffff",
        text,
        createdAt: serverTimestamp(),
        expireAt: new Date(Date.now() + 3600000), // 1 hour expiry
      });
      msgInput.value = '';
    } catch (error) {
      console.error("Send message error:", error);
      alert("Failed to send message.");
    }
  });
</script>
</body>
</html>
